<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>

  <body style="margin:0; overflow:hidden;">
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- TARGET 0 -->
      <a-entity mindar-image-target="targetIndex: 0">
          <a-gltf-model 
            id="modeloLucas"
            src="./lucas.glb"
            position="0 0 0"
            scale="0.5 0.5 0.5"
            rotation="0 0 0">
          </a-gltf-model>
      </a-entity>

      <!-- TARGET 1 -->
      <a-entity mindar-image-target="targetIndex: 1">
          <a-box position="0 0 0.2" depth="0.2" height="0.2" width="0.2"></a-box>
      </a-entity>

    </a-scene>

    <!-- SCRIPT DE ROTACIÓN -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const model = document.querySelector("#modeloLucas");
  if (!model) return;

  // Sensibilidad
  const ROTATE_SPEED = 0.5;   // sube/baja para rotación
  const ZOOM_SPEED   = 0.002; // sube/baja para zoom (pinch)
  const MIN_SCALE = 0.1;
  const MAX_SCALE = 3.0;

  // Estado
  let isRotating = false;
  let prevX = 0;
  let prevY = 0;

  let isPinching = false;
  let prevPinchDist = 0;

  // Escala base (para no “resetear”)
  let baseScale = model.getAttribute("scale") || { x: 0.5, y: 0.5, z: 0.5 };

  function clamp(v, min, max) {
    return Math.max(min, Math.min(max, v));
  }

  function touchDistance(t1, t2) {
    const dx = t2.clientX - t1.clientX;
    const dy = t2.clientY - t1.clientY;
    return Math.hypot(dx, dy);
  }

  window.addEventListener("touchstart", function (event) {
    if (!model) return;

    if (event.touches.length === 1) {
      // Rotación
      isRotating = true;
      isPinching = false;

      prevX = event.touches[0].clientX;
      prevY = event.touches[0].clientY;
    }

    if (event.touches.length === 2) {
      // Zoom (pinch)
      isPinching = true;
      isRotating = false;

      prevPinchDist = touchDistance(event.touches[0], event.touches[1]);
      // Guarda escala actual como base
      baseScale = model.getAttribute("scale") || baseScale;
    }
  }, { passive: true });

  window.addEventListener("touchmove", function (event) {
    if (!model) return;

    // 2 dedos: zoom
    if (isPinching && event.touches.length === 2) {
      const dist = touchDistance(event.touches[0], event.touches[1]);
      const delta = dist - prevPinchDist;
      prevPinchDist = dist;

      // Ajuste de escala: delta positivo => zoom in
      const factor = 1 + (delta * ZOOM_SPEED);

      const current = model.getAttribute("scale") || baseScale;
      const next = {
        x: clamp(current.x * factor, MIN_SCALE, MAX_SCALE),
        y: clamp(current.y * factor, MIN_SCALE, MAX_SCALE),
        z: clamp(current.z * factor, MIN_SCALE, MAX_SCALE),
      };

      model.setAttribute("scale", next);
      return;
    }

    // 1 dedo: rotación
    if (isRotating && event.touches.length === 1) {
      const x = event.touches[0].clientX;
      const y = event.touches[0].clientY;

      const deltaX = x - prevX;
      const deltaY = y - prevY;

      prevX = x;
      prevY = y;

      const r = model.getAttribute("rotation") || { x: 0, y: 0, z: 0 };

      model.setAttribute("rotation", {
        x: r.x - deltaY * ROTATE_SPEED, // arriba => rota arriba (como querías)
        y: r.y - deltaX * ROTATE_SPEED,
        z: r.z
      });
    }
  }, { passive: true });

  window.addEventListener("touchend", function (event) {
    // Si quedan menos de 2 dedos, se apaga pinch
    if (event.touches.length < 2) isPinching = false;
    // Si quedan 0 dedos, se apaga rotación
    if (event.touches.length === 0) isRotating = false;

    // Si quedo 1 dedo, vuelve a modo rotación sin salto
    if (event.touches.length === 1) {
      isRotating = true;
      prevX = event.touches[0].clientX;
      prevY = event.touches[0].clientY;
    }
  }, { passive: true });
});
</script>



  </body>
</html>





